<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nano Banana Áπ™ÂúñÈ¢®Ê†ºÊèêÁ§∫Ë©ûÂ∫´</title>
    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçå</text></svg>"
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçå</text></svg>"
    />
    <style>
      :root {
        /* Core Colors - Bohemian / Earthy Palette */
        --md-sys-color-primary: #e07a5f; /* Terracotta */
        --md-sys-color-on-primary: #ffffff;
        --md-sys-color-primary-container: #ffdbc8;
        --md-sys-color-on-primary-container: #3d1d16;

        --md-sys-color-secondary: #81b29a; /* Sage Green */
        --md-sys-color-secondary-container: #d8e5de;
        --md-sys-color-on-secondary-container: #1a3328;

        --md-sys-color-background: #f4f1de; /* Warm Beige */
        --md-sys-color-on-background: #2f2421; /* Dark Brown */

        --md-sys-color-surface: #fdfcf0; /* Cream / Off-white */
        --md-sys-color-surface-variant: #e6e1d3;
        --md-sys-color-on-surface: #2f2421;
        --md-sys-color-on-surface-variant: #5e504a;

        --md-sys-color-outline: #9c8d85;

        /* Elevation & Shape */
        --md-sys-elevation-level1: 0px 4px 8px rgba(0, 0, 0, 0.05),
          0px 1px 3px rgba(0, 0, 0, 0.1);
        --md-sys-shape-corner-large: 32px; /* Extra organic/rounded */
        --md-sys-shape-corner-full: 9999px; /* Capsule */

        /* Typography */
        --md-sys-typescale-headline-large: 400 32px/40px "Georgia",
          "Times New Roman", serif;
        --md-sys-typescale-title-medium: 600 18px/24px "Georgia",
          "Times New Roman", serif;
        --md-sys-typescale-body-medium: 400 14px/20px "Helvetica Neue",
          Helvetica, Arial, sans-serif;

        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background-color: var(--md-sys-color-background);
        color: var(--md-sys-color-on-background);
        transition: background-color 0.3s, color 0.3s;
      }

      body {
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      /*AppBar*/
      header {
        width: 100%;
        padding: 24px;
        box-sizing: border-box;
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
      }

      h1 {
        font: var(--md-sys-typescale-headline-large);
        margin: 0;
        color: var(--md-sys-color-on-background);
      }

      /* Controls */
      .controls {
        display: flex;
        gap: 16px;
        align-items: center;
      }

      .color-picker-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--md-sys-color-surface-variant);
        padding: 8px 16px;
        border-radius: var(--md-sys-shape-corner-full);
        color: var(--md-sys-color-on-surface-variant);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
      }

      .select-wrapper select {
        border: none;
        background: none;
        font-family: inherit;
        font-size: inherit;
        color: inherit;
        cursor: pointer;
        outline: none;
        padding-right: 4px;
      }

      input[type="color"] {
        border: none;
        width: 24px;
        height: 24px;
        padding: 0;
        background: none;
        cursor: pointer;
      }

      /* Grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
        width: 100%;
        max-width: 1200px;
        padding: 24px;
        box-sizing: border-box;
      }

      /* Card */
      .card {
        background-color: var(--md-sys-color-surface);
        border-radius: var(--md-sys-shape-corner-large);
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        position: relative;
        overflow: hidden;
        border: 1px solid var(--md-sys-color-outline);
        transition: all 0.2s ease;
      }

      .card:hover {
        box-shadow: var(--md-sys-elevation-level1);
        border-color: transparent;
        background-color: var(--md-sys-color-surface-variant);
      }

      .card-title {
        font: var(--md-sys-typescale-title-medium);
        color: var(--md-sys-color-on-surface);
        margin: 0;
      }

      .card-image-container {
        position: relative;
        width: 100%;
        border-radius: 16px;
        overflow: hidden;
      }

      .card-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        display: block;
        background-color: var(--md-sys-color-surface-variant);
        transition: transform 0.3s ease;
      }

      .card-image-container:hover .card-image {
        transform: scale(1.05);
      }

      .card-image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        cursor: pointer;
      }

      .card-image-container:hover .card-image-overlay {
        opacity: 1;
      }

      .btn-view-details {
        background-color: white;
        color: var(--md-sys-color-on-surface);
        border: none;
        border-radius: var(--md-sys-shape-corner-full);
        padding: 12px 24px;
        font: var(--md-sys-typescale-title-medium);
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .btn-view-details:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      .card-prompt {
        font: var(--md-sys-typescale-body-medium);
        color: var(--md-sys-color-on-surface-variant);
        background: rgba(0, 0, 0, 0.05);
        padding: 12px;
        border-radius: 8px;
        white-space: pre-wrap;
        word-break: break-all;
        flex-grow: 1;
      }

      /* Pinned Badge */
      .pinned-badge {
        position: absolute;
        top: 12px;
        right: 48px; /* Moved left to make room for pin button */
        background-color: var(--md-sys-color-primary);
        color: var(--md-sys-color-on-primary);
        padding: 4px 12px;
        border-radius: var(--md-sys-shape-corner-full);
        font-size: 12px;
        font-weight: 600;
        z-index: 10;
        box-shadow: var(--md-sys-elevation-level1);
        display: flex;
        align-items: center;
        gap: 4px;
        pointer-events: none;
      }

      /* Pin Button */
      .pin-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 11;
        font-size: 16px;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .pin-btn:hover {
        background: white;
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      }

      .pin-btn.active {
        background: var(--md-sys-color-primary-container);
        color: var(--md-sys-color-on-primary-container);
      }

      /* Button Container */
      .btn-container {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      /* Capsule Button */
      .btn-copy {
        background-color: var(--md-sys-color-primary);
        color: var(--md-sys-color-on-primary);
        border: none;
        border-radius: var(--md-sys-shape-corner-full);
        padding: 10px 24px;
        font: var(--md-sys-typescale-title-medium);
        cursor: pointer;
        transition: box-shadow 0.2s, background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-copy:hover {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        background-color: var(--md-sys-color-primary-container);
        color: var(--md-sys-color-on-primary-container);
      }

      .btn-copy:active {
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
      }

      /* Gemini Button */
      .btn-gemini {
        background: white; /* Changed from gradient to white */
        border: 2px solid transparent;
        border-radius: 50%; /* Circle */
        width: 48px;  /* Match height for circle */
        height: 48px;
        padding: 0;
        cursor: pointer;
        transition: box-shadow 0.2s, transform 0.2s, background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }

      .btn-gemini img {
        width: 24px;
        height: 24px;
        display: block;
      }

      .btn-gemini:hover {
        box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        transform: translateY(-2px) scale(1.05);
        background-color: #f8f9fa;
      }

      .btn-gemini:active {
        transform: translateY(0) scale(0.95);
        opacity: 0.9;
      }

      /* Toast */
      #toast {
        visibility: hidden;
        min-width: 250px;
        background-color: var(--md-sys-color-on-surface);
        color: var(--md-sys-color-surface);
        text-align: center;
        border-radius: var(--md-sys-shape-corner-full);
        padding: 16px;
        position: fixed;
        z-index: 2000;
        left: 50%;
        bottom: 30px;
        transform: translateX(-50%);
        font: var(--md-sys-typescale-body-medium);
        opacity: 0;
        transition: opacity 0.3s, bottom 0.3s;
      }

      #toast.show {
        visibility: visible;
        opacity: 1;
        bottom: 50px;
      }

      /* Category Filters */
      .category-filters {
        width: 100%;
        max-width: 1200px;
        padding: 0 24px 24px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: center;
      }

      .filter-btn {
        border: none;
        padding: 8px;
        border-radius: 50px; /* Fully rounded/organic */
        font-family: "Georgia", serif; /* More artistic font */
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #3d1d16; /* Dark brown text */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        opacity: 0.8;
      }

      .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        opacity: 1;
      }

      .filter-btn.active {
        opacity: 1;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        border: 2px solid var(--md-sys-color-primary);
      }

      .filter-btn-all {
        background-color: #e6e1d3;
      }
      .filter-btn-business {
        background-color: #cad2c5;
      } /* Earthy Blue-Grey */
      .filter-btn-art {
        background-color: #e2cba9;
      } /* Earthy Clay */
      .filter-btn-fun {
        background-color: #abc4ab;
      } /* Earthy Sage */
      .filter-btn-retro {
        background-color: #f2cc8f;
      } /* Earthy Ochre */
      .filter-btn-tech {
        background-color: #a4c3b2;
      } /* Earthy Teal */
      .filter-btn-special {
        background-color: #e5989b;
      } /* Earthy Pink */

      .card-section-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: var(--md-sys-color-on-surface);
      }

      .card-features {
        list-style-type: disc;
        padding-left: 20px;
        margin: 0;
        font: var(--md-sys-typescale-body-medium);
        color: var(--md-sys-color-on-surface-variant);
      }

      .card-features li {
        margin-bottom: 4px;
      }

      .card-scenarios {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .scenario-tag {
        background-color: var(--md-sys-color-secondary-container);
        color: var(--md-sys-color-on-secondary-container);
        padding: 4px 12px;
        border-radius: 16px;
        font-size: 12px;
        font-weight: 500;
      }

      /* Modal / Lightbox */
      .modal {
        display: none;
        position: fixed;
        z-index: 1100; /* Higher than details-modal */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.9); /* Darker backdrop */
        backdrop-filter: blur(5px);
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .modal.show {
        opacity: 1;
      }

      .modal-content {
        margin: auto;
        display: block;
        max-width: 90%;
        max-height: 90%;
        border-radius: var(--md-sys-shape-corner-large);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        transform: scale(0.8);
        transition: transform 0.3s ease;
      }

      .modal.show .modal-content {
        transform: scale(1);
      }

      .close {
        position: absolute;
        top: 20px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
        cursor: pointer;
        z-index: 1101; /* Higher than modal */
      }

      .close:hover,
      .close:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
      }

      /* Details Modal */
      .details-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.6);
        backdrop-filter: blur(8px);
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        padding: 24px;
        box-sizing: border-box;
      }

      .details-modal.show {
        opacity: 1;
      }

      .details-modal-content {
        background-color: var(--md-sys-color-surface);
        border-radius: var(--md-sys-shape-corner-large);
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        padding: 32px;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3);
        transform: scale(0.9) translateY(20px);
        transition: transform 0.3s ease;
        position: relative;
      }

      .details-modal.show .details-modal-content {
        transform: scale(1) translateY(0);
      }

      .details-modal-close {
        position: absolute;
        top: 16px;
        right: 16px;
        background: var(--md-sys-color-surface-variant);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 24px;
        color: var(--md-sys-color-on-surface-variant);
        transition: all 0.2s;
      }

      .details-modal-close:hover {
        background: var(--md-sys-color-primary-container);
        color: var(--md-sys-color-on-primary-container);
      }

      .details-modal-header {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 24px;
        padding-right: 48px;
      }

      .details-modal-image {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 16px;
        flex-shrink: 0;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .details-modal-image:hover {
        transform: scale(1.05);
      }

      .details-modal-title {
        font: var(--md-sys-typescale-headline-large);
        font-size: 24px;
        margin: 0;
        color: var(--md-sys-color-on-surface);
      }

      .details-modal-section {
        margin-bottom: 20px;
      }

      .details-modal-section:last-child {
        margin-bottom: 0;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Nano Banana Áπ™ÂúñÈ¢®Ê†ºÊèêÁ§∫Ë©ûÂ∫´</h1>

      <div class="controls">
        <div class="color-picker-wrapper select-wrapper">
          <label for="aspectRatio">ÊØî‰æã</label>
          <select id="aspectRatio">
            <option value="Aspect ratio: 16:9 horizontal">16:9 Ê©´Âêë</option>
            <option value="Aspect ratio: 9:16 vertical">9:16 Áõ¥Âêë</option>
            <option value="Aspect ratio: 1:1 square">1:1 ÊñπÂΩ¢</option>
            <option value="Aspect ratio: 4:3 horizontal">4:3 Ê©´Âêë</option>
            <option value="Aspect ratio: 3:4 vertical">3:4 Áõ¥Âêë</option>
            <option value="Aspect ratio: 21:9 ultrawide">21:9 Ë∂ÖÂØ¨</option>
          </select>
        </div>



        <!--
        <div class="color-picker-wrapper">
          <label for="colorPicker">‰∏ªÈ°åËâ≤ (Dynamic Color)</label>
          <input type="color" id="colorPicker" value="#E07A5F" />
        </div>
        -->

        <div class="color-picker-wrapper">
          <label for="customContent">Content</label>
          <input
            type="text"
            id="customContent"
            placeholder="Ëá™Ë®ÇÊèêÁ§∫Ë©û..."
            style="border: none; background: none; outline: none; font: inherit; color: inherit; width: 120px;"
          />
        </div>



      </div>
    </header>

    <div class="category-filters" id="categoryFilters">
      <!-- Buttons generated by JS -->
    </div>

    <div class="grid" id="styleGrid">
      <!-- Cards will be injected here -->
    </div>

    <div id="toast">Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ</div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
      <span class="close">&times;</span>
      <img class="modal-content" id="modalImage">
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="details-modal">
      <div class="details-modal-content" id="detailsModalContent">
        <button class="details-modal-close" onclick="closeDetailsModal()">&times;</button>
        <div id="detailsModalBody"></div>
      </div>
    </div>

    <script src="stylesData.js"></script>

    <script>
      // ---------------------------------------------------------
      // 2. RENDER LOGIC
      // ---------------------------------------------------------
      const grid = document.getElementById("styleGrid");
      const categoryFilters = document.getElementById("categoryFilters");

      // Aspect Ratio Logic
      const aspectRatioSelect = document.getElementById("aspectRatio");
      let currentAspectRatio = "Aspect ratio: 16:9 horizontal"; // Default

      if (aspectRatioSelect) {
        aspectRatioSelect.addEventListener("change", (e) => {
          currentAspectRatio = e.target.value;
          filterStyles(currentCategory); // Re-render to update prompt text
        });
      }

      // Custom Content Logic
      const customContentInput = document.getElementById("customContent");
      let customContent = "";

      // Negative Prompt Constant
      const NEGATIVE_PROMPT = `
Ë≤†ÂêëÁ¥ÑÊùü
Negative prompt: blurry text, gibberish, typo, misspelling, distorted graphs, extra limbs, low resolution, watermark, signature, cut off text, ugly, deformed, lowpoly, amateur design, cluttered, unreadable text, incorrect spelling, broken layout, pixelated, jpeg artifacts, cropped content`;

      // Helper to build the full prompt string
      function buildFullPrompt(index) {
        let promptText = stylesData[index].prompt;
        if (customContent) {
          promptText = promptText.replace(/{PROMPT}/g, customContent);
        }

        // Append Negative Prompt
        promptText += "\n" + NEGATIVE_PROMPT;

        // Append Aspect Ratio
        return promptText.trim() + "\n\n" + currentAspectRatio;
      }

      if (customContentInput) {
        customContentInput.addEventListener("input", (e) => {
          customContent = e.target.value;
          filterStyles(currentCategory); // Re-render to update prompt text
        });
      }



      const categories = [
        {
          id: "all",
          name: "ÂÖ®ÈÉ®È°ØÁ§∫",
          icon: "üìã",
          className: "filter-btn-all",
        },
        {
          id: "business",
          name: "Â∞àÊ•≠ÂïÜÂãô (5Á®Æ)",
          icon: "üíº",
          className: "filter-btn-business",
          range: [0, 4],
        },
        {
          id: "art",
          name: "ÊèíÁï´ËóùË°ì (6Á®Æ)",
          icon: "üé®",
          className: "filter-btn-art",
          range: [5, 10],
        },
        {
          id: "fun",
          name: "Ë∂£Âë≥ÂâµÊÑè (6Á®Æ)",
          icon: "üéÆ",
          className: "filter-btn-fun",
          range: [11, 16],
        },
        {
          id: "retro",
          name: "Âæ©Âè§Á∂ìÂÖ∏ (5Á®Æ)",
          icon: "üìú",
          className: "filter-btn-retro",
          range: [17, 21],
        },
        {
          id: "tech",
          name: "ÊäÄË°ìÂúñËß£ (4Á®Æ)",
          icon: "üî¨",
          className: "filter-btn-tech",
          range: [22, 25],
        },
        {
          id: "special",
          name: "ÁâπÊÆäÈ¢®Ê†º (6Á®Æ)",
          icon: "‚ú®",
          className: "filter-btn-special",
          range: [26, 31],
        },
      ];

      // Pinning Logic
      let pinnedIndices = [];
      try {
        const stored = localStorage.getItem('pinnedStyles');
        if (stored) {
          pinnedIndices = JSON.parse(stored);
        }
      } catch (e) {
        console.error("Failed to load pinned styles", e);
      }

      function togglePin(originalIndex, event) {
        if (event) {
          event.stopPropagation();
        }

        const idx = pinnedIndices.indexOf(originalIndex);
        if (idx === -1) {
          pinnedIndices.push(originalIndex);
        } else {
          pinnedIndices.splice(idx, 1);
        }

        localStorage.setItem('pinnedStyles', JSON.stringify(pinnedIndices));
        filterStyles(currentCategory);
      }

      let currentCategory = "all";

      function initFilters() {
        categoryFilters.innerHTML = "";
        categories.forEach((cat) => {
          const btn = document.createElement("button");
          btn.className = `filter-btn ${cat.className} ${
            cat.id === currentCategory ? "active" : ""
          }`;
          btn.innerHTML = `<span>${cat.icon}</span> ${cat.name}`;
          btn.onclick = () => filterStyles(cat.id);
          categoryFilters.appendChild(btn);
        });
      }

      function filterStyles(categoryId) {
        currentCategory = categoryId;
        initFilters(); // Re-render buttons to update active state

        const category = categories.find((c) => c.id === categoryId);
        let filteredData = [];

        // Prepare data with original index
        const allDataWithIndex = stylesData.map((style, index) => ({
          ...style,
          originalIndex: index,
        }));

        if (categoryId === "all") {
          filteredData = allDataWithIndex;
        } else {
          // Filter by range of index
          filteredData = allDataWithIndex.filter(
            (item) =>
              item.originalIndex >= category.range[0] &&
              item.originalIndex <= category.range[1]
          );
        }

        // Sort: Pinned items first
        filteredData.sort((a, b) => {
          const aPinned = pinnedIndices.includes(a.originalIndex);
          const bPinned = pinnedIndices.includes(b.originalIndex);

          if (aPinned && !bPinned) return -1;
          if (!aPinned && bPinned) return 1;
          return 0; // Maintain original relative order
        });

        renderCards(filteredData);
      }

      function renderCards(data) {
        // Fallback if called without arguments (initial load)
        if (!data) {
          data = stylesData.map((style, index) => ({
            ...style,
            originalIndex: index,
          }));
        }

        grid.innerHTML = "";
        data.forEach((style) => {
          const card = document.createElement("div");
          card.className = "card";

          // Pinned Check
          const isPinned = pinnedIndices.includes(style.originalIndex);

          // Pin Button
          const pinBtnTitle = isPinned ? "ÂèñÊ∂àÁΩÆÈ†Ç" : "ÁΩÆÈ†Ç";
          const pinBtnIcon = isPinned ? "üìå" : "üìç";
          const pinBtnClass = isPinned ? "pin-btn active" : "pin-btn";

          const pinButton = `<button class="${pinBtnClass}" onclick="togglePin(${style.originalIndex}, event)" title="${pinBtnTitle}">${pinBtnIcon}</button>`;

          // Image path based on originalIndex (1-indexed)
          const imageNumber = style.originalIndex + 1;
          const imagePath = `images/style_${imageNumber}.png`;

          // Simplified card: only title + image with hover overlay
          card.innerHTML = `
                ${pinButton}
                <h3 class="card-title">${style.name}</h3>
                <div class="card-image-container">
                  <img src="${imagePath}" alt="${style.name}" class="card-image" loading="lazy">
                  <div class="card-image-overlay" onclick="openDetailsModal(${style.originalIndex})">
                    <button class="btn-view-details">
                      <span>üëÅÔ∏è</span> Êü•ÁúãË©≥ÊÉÖ
                    </button>
                  </div>
                </div>
            `;
          grid.appendChild(card);
        });
      }

      // Initialize
      initFilters();
      filterStyles('all'); // Initial render with specific sorting (pinned first)

      // ---------------------------------------------------------
      // 3. COPY FUNCTIONALITY
      // ---------------------------------------------------------
      function copyToClipboard(index) {
        const text = buildFullPrompt(index);

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showToast("Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ");
            })
            .catch((err) => {
              console.warn("Clipboard API failed, trying fallback:", err);
              fallbackCopyTextToClipboard(text);
            });
        } else {
          fallbackCopyTextToClipboard(text);
        }
      }

      function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;

        // Ensure it's not visible but part of the DOM
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        textArea.style.top = "0";

        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
          const successful = document.execCommand("copy");
          if (successful) {
            showToast("Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ");
          }
        } catch (err) {
          console.error("Fallback: Unable to copy", err);
        }

        document.body.removeChild(textArea);
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        if (message) {
          toast.textContent = message;
        }
        toast.className = "show";
        setTimeout(function () {
          toast.className = toast.className.replace("show", "");
        }, 3000);
      }

      // ---------------------------------------------------------
      // COPY AND OPEN GEMINI
      // ---------------------------------------------------------
      function copyAndOpenGemini(index) {
        const text = buildFullPrompt(index);

        // Copy to clipboard as backup
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text).catch(err => console.warn("Clipboard failed", err));
        } else {
          fallbackCopyTextToClipboard(text);
        }

        // Open Gemini immediately
        showToast("Â∑≤Ë§áË£ΩÔºÅÊ≠£Âú®ÈñãÂïü Gemini...");
        openGeminiWithPrompt(text);
      }

      function openGeminiWithPrompt(prompt) {
        const encodedPrompt = encodeURIComponent(prompt);
        // Use user-provided deep link format
        const geminiUrl = `https://gemini.google.com/app#autoSubmit=false&pasteImage=1&tool=image&prompt=${encodedPrompt}`;
        window.open(geminiUrl, '_blank');
      }



      // ---------------------------------------------------------
      // DETAILS MODAL LOGIC
      // ---------------------------------------------------------
      const detailsModal = document.getElementById("detailsModal");
      const detailsModalBody = document.getElementById("detailsModalBody");

      function openDetailsModal(index) {
        const style = stylesData[index];
        const imageNumber = index + 1;
        const imagePath = `images/style_${imageNumber}.png`;

        // Format features
        const featuresList = style.features
          ? `<div class="details-modal-section">
               <div class="card-section-title">ÁâπËâ≤</div>
               <ul class="card-features">
                 ${style.features
                   .map(
                     (f) =>
                       `<li>${f.replace(
                         /\*\*(.*?)\*\*/g,
                         "<strong>$1</strong>"
                       )}</li>`
                   )
                   .join("")}
               </ul>
             </div>`
          : "";

        // Format scenarios
        const scenariosList = style.scenarios
          ? `<div class="details-modal-section">
               <div class="card-section-title">ÈÅ©Áî®Â†¥ÊôØ</div>
               <div class="card-scenarios">
                 ${style.scenarios
                   .map((s) => `<span class="scenario-tag">${s}</span>`)
                   .join("")}
               </div>
             </div>`
          : "";

        // Build Full Prompt
        const displayPrompt = buildFullPrompt(index);

        const promptDisplay = `
          <div class="details-modal-section">
            <div class="card-section-title">ÊèêÁ§∫Ë©û</div>
            <div class="card-prompt">${displayPrompt}</div>
          </div>`;

        detailsModalBody.innerHTML = `
          <div class="details-modal-header">
            <img src="${imagePath}" alt="${style.name}" class="details-modal-image" onclick="openModal('${imagePath}')">
            <h2 class="details-modal-title">${style.name}</h2>
          </div>
          ${featuresList}
          ${scenariosList}
          ${promptDisplay}
          <div class="btn-container" style="align-items: center; margin-top: 24px;">
            <button class="btn-copy" onclick="copyToClipboard(${index})" style="flex-grow: 1;">
                Ë§áË£ΩÊèêÁ§∫Ë©û
            </button>
            <button class="btn-gemini" onclick="copyAndOpenGemini(${index})" title="Âú® Gemini ÈñãÂïü">
                <img src="images/gemini_logo.svg" alt="Gemini">
            </button>
          </div>
        `;

        detailsModal.style.display = "flex";
        void detailsModal.offsetWidth;
        detailsModal.classList.add("show");
        document.body.style.overflow = "hidden";
      }

      function closeDetailsModal() {
        detailsModal.classList.remove("show");
        setTimeout(() => {
          detailsModal.style.display = "none";
          document.body.style.overflow = "";
        }, 300);
      }

      // Close details modal when clicking outside
      if (detailsModal) {
        detailsModal.onclick = function(event) {
          if (event.target === detailsModal) {
            closeDetailsModal();
          }
        }
      }

      // ---------------------------------------------------------
      // 4. MODAL LOGIC
      // ---------------------------------------------------------
      // ---------------------------------------------------------
      // 4. MODAL LOGIC (Image Lightbox)
      // ---------------------------------------------------------
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      const closeBtn = document.getElementsByClassName("close")[0];

      function openModal(src) {
        modal.style.display = "flex";
        // Force reflow for transition
        void modal.offsetWidth;
        modal.classList.add("show");
        modalImg.src = src;
        document.body.style.overflow = "hidden"; // Prevent scrolling
      }

      function closeModal() {
        modal.classList.remove("show");
        setTimeout(() => {
          modal.style.display = "none";
          // Only restore scroll if details modal is ALSO closed
          if (!detailsModal.classList.contains("show")) {
             document.body.style.overflow = "";
          }
        }, 300);
      }

      if (closeBtn) {
        closeBtn.onclick = function() {
          closeModal();
        }
      }

      if (modal) {
        modal.onclick = function(event) {
          if (event.target === modal) {
            closeModal();
          }
        }
      }

      // Unified Global Event Listeners
      document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") {
          // If top-most modal (image) is open, close it
          if (modal.style.display === "flex") {
            closeModal();
            return; // Stop here, don't close details yet
          }
          // If details modal is open (and image modal wasn't), close it
          if (detailsModal.style.display === "flex") {
            closeDetailsModal();
          }
        }
      });

      // ---------------------------------------------------------
      // 5. DYNAMIC COLOR LOGIC (Simple Simulation)
      // ---------------------------------------------------------
      const colorPicker = document.getElementById("colorPicker");

      colorPicker.addEventListener("input", (e) => {
        const hex = e.target.value;
        updateTheme(hex);
      });

      function updateTheme(hex) {
        // In a real app, we would use material-color-utilities to generate the full tonal palette.
        // Here we simulate the effect by adjusting lightness for containers/on-colors.
        document.documentElement.style.setProperty(
          "--md-sys-color-primary",
          hex
        );
        document.documentElement.style.setProperty(
          "--md-sys-color-primary-container",
          adjustColor(hex, 150)
        ); // lighter
        document.documentElement.style.setProperty(
          "--md-sys-color-on-primary-container",
          adjustColor(hex, -100)
        ); // darker
      }

      // Simple utility to lighten/darken hex for demo purposes
      function adjustColor(color, amount) {
        return (
          "#" +
          color
            .replace(/^#/, "")
            .replace(/../g, (color) =>
              (
                "0" +
                Math.min(
                  255,
                  Math.max(0, parseInt(color, 16) + amount)
                ).toString(16)
              ).substr(-2)
            )
        );
      }

      // Init
      renderCards();
    </script>
  </body>
</html>
